# Configuration Robot Mecanum Autonome
# Raspberry Pi 5 + Raspberry Pi Pico

# Communication UART (Pi5 ↔ Pico)
uart:
  port: /dev/ttyAMA3     # UART3 sur Pi5
  baudrate: 115200
  protocol: stx_etx      # Protocole avec STX/ETX et CRC-8

# Pins UART3 sur Pi5
# GPIO8 (broche 24) = TX → GP1 (Pico RX)
# GPIO9 (broche 21) = RX ← GP0 (Pico TX)
# GND (broche 20) = GND

# Configuration moteurs Mecanum
# Carte driver: HW-249 (4x pont en H)
motors:
  type: mecanum
  pwm_frequency: 1000    # Hz
  max_speed: 100         # %
  driver: hw249

  # Disposition des roues (vue de dessus)
  #   FL ──── FR
  #   │  ↑   │
  #   │ AVANT│
  #   RL ──── RR

  pins:
    # Front Left (avant gauche)
    FL_in1: 17           # GPIO17 - avant
    FL_in2: 27           # GPIO27 - arrière

    # Front Right (avant droit)
    FR_in1: 22           # GPIO22 - avant
    FR_in2: 23           # GPIO23 - arrière

    # Rear Left (arrière gauche)
    RL_in1: 24           # GPIO24 - avant
    RL_in2: 25           # GPIO25 - arrière

    # Rear Right (arrière droit)
    RR_in1: 5            # GPIO5 - avant
    RR_in2: 6            # GPIO6 - arrière

# LiDAR RPLidar C1 (USB)
lidar:
  port: /dev/ttyUSB0
  baudrate: 460800
  min_quality: 10

# Navigation autonome et patrouille
navigation:
  waypoint_radius: 3.0   # metres - rayon de validation waypoint
  patrol_speed: 40       # % vitesse max en patrouille
  obstacle_distance: 800 # mm - distance d'evitement
  patrol_file: config/patrol_route.json
  loop: true             # boucler la patrouille
  pid:
    kp: 1.0
    ki: 0.05
    kd: 0.1

# Authentification interface web (HTTP Basic Auth)
# Pour generer un nouveau hash:
#   python -c "from werkzeug.security import generate_password_hash; print(generate_password_hash('MON_MDP'))"
auth:
  username: admin
  password_hash: "REDACTED_HASH"

# TLS / HTTPS (certificat auto-signe)
# Generer le certificat:
#   openssl req -x509 -newkey rsa:2048 -keyout config/ssl/key.pem -out config/ssl/cert.pem -days 3650 -nodes -subj '/CN=robot-mecanum'
# Si les fichiers n'existent pas, le serveur demarre en HTTP
tls:
  cert: config/ssl/cert.pem
  key: config/ssl/key.pem

# Serveur web (télémétrie + contrôle)
telemetry:
  web_server_port: 8085
  update_rate: 10        # Hz
  enable_logging: true

# Capteurs (sur Pico)
sensors:
  gps:
    type: neo_6m
    uart: 0              # UART0 du Pico
    baudrate: 9600
  imu:
    type: bmi160
    i2c_bus: 1           # I2C1 du Pico
    address: 0x68
